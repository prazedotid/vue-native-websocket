{"version":3,"file":"build.js","mappings":"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","sources":["webpack://VueNativeSock/webpack/universalModuleDefinition","webpack://VueNativeSock/webpack/bootstrap","webpack://VueNativeSock/webpack/runtime/define property getters","webpack://VueNativeSock/webpack/runtime/hasOwnProperty shorthand","webpack://VueNativeSock/webpack/runtime/make namespace object","webpack://VueNativeSock/./src/Emitter.js","webpack://VueNativeSock/./src/Observer.js","webpack://VueNativeSock/./src/Main.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"VueNativeSock\"] = factory();\n\telse\n\t\troot[\"VueNativeSock\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","class Emitter {\r\n  constructor () {\r\n    this.listeners = new Map()\r\n  }\r\n\r\n  addListener (label, callback, vm) {\r\n    if (typeof callback === 'function') {\r\n      this.listeners.has(label) || this.listeners.set(label, [])\r\n      this.listeners.get(label).push({ callback, vm })\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n  removeListener (label, callback, vm) {\r\n    const listeners = this.listeners.get(label)\r\n    let index\r\n\r\n    if (listeners && listeners.length) {\r\n      index = listeners.reduce((i, listener, index) => {\r\n        if (typeof listener.callback === 'function' && listener.callback === callback && listener.vm === vm) {\r\n          i = index\r\n        }\r\n        return i\r\n      }, -1)\r\n\r\n      if (index > -1) {\r\n        listeners.splice(index, 1)\r\n        this.listeners.set(label, listeners)\r\n        return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  emit (label, ...args) {\r\n    const listeners = this.listeners.get(label)\r\n\r\n    if (listeners && listeners.length) {\r\n      listeners.forEach((listener) => {\r\n        listener.callback.call(listener.vm, ...args)\r\n      })\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n}\r\n\r\nexport default new Emitter()\r\n","import Emitter from './Emitter'\r\n\r\nexport default class {\r\n  constructor (connectionUrl, opts = {}) {\r\n    this.format = opts.format && opts.format.toLowerCase()\r\n\r\n    if (connectionUrl.startsWith('//')) {\r\n      const scheme = window.location.protocol === 'https:' ? 'wss' : 'ws'\r\n      connectionUrl = `${scheme}:${connectionUrl}`\r\n    }\r\n\r\n    this.connectionUrl = connectionUrl\r\n    this.opts = opts\r\n\r\n    this.reconnection = this.opts.reconnection || false\r\n    this.reconnectionAttempts = this.opts.reconnectionAttempts || Infinity\r\n    this.reconnectionDelay = this.opts.reconnectionDelay || 1000\r\n    this.reconnectTimeoutId = 0\r\n    this.reconnectionCount = 0\r\n\r\n    this.passToStoreHandler = this.opts.passToStoreHandler || false\r\n\r\n    this.connect(connectionUrl, opts)\r\n\r\n    if (opts.store) { this.store = opts.store }\r\n    if (opts.mutations) { this.mutations = opts.mutations }\r\n    this.onEvent()\r\n  }\r\n\r\n  connect (connectionUrl, opts = {}) {\r\n    const protocol = opts.protocol || ''\r\n    this.WebSocket = opts.WebSocket || (protocol === '' ? new WebSocket(connectionUrl) : new WebSocket(connectionUrl, protocol))\r\n    if (this.format === 'json') {\r\n      if (!('sendObj' in this.WebSocket)) {\r\n        this.WebSocket.sendObj = (obj) => this.WebSocket.send(JSON.stringify(obj))\r\n      }\r\n    }\r\n\r\n    return this.WebSocket\r\n  }\r\n\r\n  reconnect () {\r\n    if (this.reconnectionCount <= this.reconnectionAttempts) {\r\n      this.reconnectionCount++\r\n      clearTimeout(this.reconnectTimeoutId)\r\n\r\n      this.reconnectTimeoutId = setTimeout(() => {\r\n        if (this.store) { this.passToStore('SOCKET_RECONNECT', this.reconnectionCount) }\r\n\r\n        this.connect(this.connectionUrl, this.opts)\r\n        this.onEvent()\r\n      }, this.reconnectionDelay)\r\n    } else {\r\n      if (this.store) { this.passToStore('SOCKET_RECONNECT_ERROR', true) }\r\n    }\r\n  }\r\n\r\n  onEvent () {\r\n    ['onmessage', 'onclose', 'onerror', 'onopen'].forEach((eventType) => {\r\n      this.WebSocket[eventType] = (event) => {\r\n        Emitter.emit(eventType, event)\r\n\r\n        if (this.store) { this.passToStore('SOCKET_' + eventType, event) }\r\n\r\n        if (this.reconnection && eventType === 'onopen') {\r\n          this.opts.$setInstance(event.currentTarget)\r\n          this.reconnectionCount = 0\r\n        }\r\n\r\n        if (this.reconnection && eventType === 'onclose') { this.reconnect() }\r\n      }\r\n    })\r\n  }\r\n\r\n  passToStore (eventName, event) {\r\n    if (this.passToStoreHandler) {\r\n      this.passToStoreHandler(eventName, event, this.defaultPassToStore.bind(this))\r\n    } else {\r\n      this.defaultPassToStore(eventName, event)\r\n    }\r\n  }\r\n\r\n  defaultPassToStore (eventName, event) {\r\n    if (!eventName.startsWith('SOCKET_')) { return }\r\n    let method = 'commit'\r\n    let target = eventName.toUpperCase()\r\n    let msg = event\r\n    if (this.format === 'json' && event.data) {\r\n      msg = JSON.parse(event.data)\r\n      if (msg.mutation) {\r\n        target = [msg.namespace || '', msg.mutation].filter((e) => !!e).join('/')\r\n      } else if (msg.action) {\r\n        method = 'dispatch'\r\n        target = [msg.namespace || '', msg.action].filter((e) => !!e).join('/')\r\n      }\r\n    }\r\n    if (this.mutations) {\r\n      target = this.mutations[target] || target\r\n    }\r\n    this.store[method](target, msg)\r\n  }\r\n}\r\n","import Observer from './Observer'\r\nimport Emitter from './Emitter'\r\n\r\nexport default {\r\n\r\n  install (Vue, connection, opts = {}) {\r\n    if (!connection && !opts.connectManually) { throw new Error('[vue-native-socket] cannot locate connection') }\r\n\r\n    let observer = null\r\n\r\n    opts.$setInstance = (wsInstance) => {\r\n      Vue.prototype.$socket = wsInstance\r\n    }\r\n\r\n    if (opts.connectManually) {\r\n      Vue.prototype.$connect = (connectionUrl = connection, connectionOpts = opts) => {\r\n        connectionOpts.$setInstance = opts.$setInstance\r\n        observer = new Observer(connectionUrl, connectionOpts)\r\n        Vue.prototype.$socket = observer.WebSocket\r\n      }\r\n\r\n      Vue.prototype.$disconnect = () => {\r\n        if (observer && observer.reconnection) { observer.reconnection = false }\r\n        if (Vue.prototype.$socket) {\r\n          Vue.prototype.$socket.close()\r\n          delete Vue.prototype.$socket\r\n        }\r\n      }\r\n    } else {\r\n      observer = new Observer(connection, opts)\r\n      Vue.prototype.$socket = observer.WebSocket\r\n    }\r\n    const hasProxy = typeof Proxy !== 'undefined' && typeof Proxy === 'function' && /native code/.test(Proxy.toString())\r\n\r\n    Vue.mixin({\r\n      created () {\r\n        const vm = this\r\n        const sockets = this.$options.sockets\r\n\r\n        if (hasProxy) {\r\n          this.$options.sockets = new Proxy({}, {\r\n            set (target, key, value) {\r\n              Emitter.addListener(key, value, vm)\r\n              target[key] = value\r\n              return true\r\n            },\r\n            deleteProperty (target, key) {\r\n              Emitter.removeListener(key, vm.$options.sockets[key], vm)\r\n              delete target.key\r\n              return true\r\n            }\r\n          })\r\n          if (sockets) {\r\n            Object.keys(sockets).forEach((key) => {\r\n              this.$options.sockets[key] = sockets[key]\r\n            })\r\n          }\r\n        } else {\r\n          Object.seal(this.$options.sockets)\r\n\r\n          // if !hasProxy need addListener\r\n          if (sockets) {\r\n            Object.keys(sockets).forEach(key => {\r\n              Emitter.addListener(key, sockets[key], vm)\r\n            })\r\n          }\r\n        }\r\n      },\r\n      beforeDestroy () {\r\n        if (hasProxy) {\r\n          const sockets = this.$options.sockets\r\n\r\n          if (sockets) {\r\n            Object.keys(sockets).forEach((key) => {\r\n              delete this.$options.sockets[key]\r\n            })\r\n          }\r\n        }\r\n      }\r\n    })\r\n  }\r\n}\r\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","Emitter","this","listeners","Map","label","callback","vm","has","set","push","index","length","reduce","i","listener","splice","args","forEach","connectionUrl","opts","format","toLowerCase","startsWith","scheme","window","location","protocol","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectTimeoutId","reconnectionCount","passToStoreHandler","connect","store","mutations","onEvent","WebSocket","sendObj","send","JSON","stringify","clearTimeout","setTimeout","passToStore","eventType","event","$setInstance","currentTarget","reconnect","eventName","defaultPassToStore","bind","method","target","toUpperCase","msg","data","parse","mutation","namespace","filter","e","join","action","install","Vue","connection","connectManually","Error","observer","wsInstance","$socket","$connect","connectionOpts","Observer","$disconnect","close","hasProxy","Proxy","test","toString","mixin","created","sockets","$options","deleteProperty","keys","seal","beforeDestroy"],"sourceRoot":""}